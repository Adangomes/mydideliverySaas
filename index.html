<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaaS Cardápio Digital</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        /* CSS INTEGRADO - DESIGN MODERNO SaaS */
        :root { --primary: #e74c3c; --dark: #2c3e50; --light: #f8f9fa; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--light); color: var(--dark); }
        
        header { background: white; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 100; }
        .header-content { display: flex; align-items: center; gap: 15px; max-width: 800px; margin: 0 auto; }
        #loja-logo { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }
        
        .status { font-size: 0.8rem; padding: 2px 8px; border-radius: 12px; font-weight: bold; display: inline-block; }
        .aberto { background: #d4edda; color: #155724; }
        .fechado { background: #f8d7da; color: #721c24; }

        #categorias-scroll { display: flex; overflow-x: auto; gap: 10px; padding: 15px; background: white; white-space: nowrap; }
        .cat-link { padding: 8px 20px; background: #eee; border-radius: 20px; text-decoration: none; color: inherit; font-size: 0.9rem; }
        .cat-link.active { background: var(--primary); color: white; }

        .item-produto { background: white; margin: 10px; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; cursor: pointer; transition: 0.3s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .item-produto:hover { transform: scale(1.02); }
        .info-p h3 { font-size: 1rem; }
        .info-p p { font-size: 0.8rem; color: #777; }
        .preco { color: var(--primary); font-weight: bold; display: block; margin-top: 5px; }
        .foto-p img { width: 80px; height: 80px; border-radius: 8px; object-fit: cover; }

        #btn-carrinho-fixo { position: fixed; bottom: 20px; right: 20px; background: var(--primary); color: white; padding: 15px 25px; border-radius: 30px; box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4); display: flex; align-items: center; gap: 10px; cursor: pointer; z-index: 999; }
        
        /* Estilo Modo Admin */
        .modo-admin-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; color: #ccc; cursor: pointer; }
        [contenteditable="true"] { border: 1px dashed var(--primary); padding: 2px; border-radius: 4px; }
    </style>
</head>
<body>

    <header>
        <div class="header-content">
            <button class="modo-admin-btn" onclick="fazerLoginAdmin()"><i class="fa fa-cog"></i></button>
            <img id="loja-logo" src="https://via.placeholder.com/100" alt="Logo">
            <div>
                <h1 id="nome-loja">Carregando...</h1>
                <div id="status-loja"></div>
            </div>
        </div>
    </header>

    <nav id="categorias-scroll"></nav>
    <main id="cardapio-corpo"></main>

    <div id="btn-carrinho-fixo" onclick="irParaCarrinho()">
        <i class="fa fa-shopping-cart"></i>
        <span id="cart-total">R$ 0,00</span>
    </div>

    <script>
        // CONFIGURAÇÕES DO FIREBASE (VOCÊ PRECISA PREENCHER AQUI)
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_PROJETO.firebaseapp.com",
            databaseURL: "https://SEU_PROJETO.firebaseio.com",
            projectId: "SEU_PROJETO",
            storageBucket: "SEU_PROJETO.appspot.com",
            messagingSenderId: "ID",
            appId: "APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // IDENTIFICAÇÃO DA LOJA PELA URL
        const params = new URLSearchParams(window.location.search);
        const LOJA_ID = params.get('loja') || "snoop_lanche";

        let dadosLoja = {};

        // CARREGA DADOS DO FIREBASE
        async function carregarSaaS() {
            const snapshot = await db.ref(`restaurantes/${LOJA_ID}`).once('value');
            dadosLoja = snapshot.val();

            if (!dadosLoja) {
                document.body.innerHTML = "<h1>Restaurante não encontrado!</h1>";
                return;
            }

            // Preenche Header
            document.getElementById('nome-loja').innerText = dadosLoja.config.nomeLoja;
            document.getElementById('loja-logo').src = dadosLoja.config.logo || "https://via.placeholder.com/100";
            
            renderizarCardapio();
        }

        function renderizarCardapio() {
            const corpo = document.getElementById('cardapio-corpo');
            corpo.innerHTML = "";
            
            // Lógica para agrupar categorias e produtos
            dadosLoja.produtos.forEach((p, index) => {
                corpo.innerHTML += `
                    <div class="item-produto">
                        <div class="info-p">
                            <h3 class="editavel" data-path="produtos/${index}/title">${p.title}</h3>
                            <p class="editavel" data-path="produtos/${index}/ingredientes">${p.ingredientes || ""}</p>
                            <span class="preco editavel" data-path="produtos/${index}/price">R$ ${p.price.toFixed(2)}</span>
                        </div>
                        <div class="foto-p">
                            <img src="${p.image}">
                        </div>
                    </div>
                `;
            });
        }

        // SISTEMA DE LOGIN ADMIN DENTRO DO SITE
        function fazerLoginAdmin() {
            const pass = prompt("Senha do Admin:");
            if (pass === dadosLoja.config.senhaAdmin) {
                alert("Modo editor ativado! Altere os textos e clique fora para salvar.");
                ativarEditor();
            } else {
                alert("Acesso negado.");
            }
        }

        function ativarEditor() {
            document.querySelectorAll('.editavel').forEach(el => {
                el.contentEditable = true;
                el.onblur = async () => {
                    const path = el.getAttribute('data-path');
                    let novoValor = el.innerText;
                    
                    // Se for preço, converte para número
                    if(path.includes('price')) novoValor = parseFloat(novoValor.replace('R$', '').trim());

                    await db.ref(`restaurantes/${LOJA_ID}/${path}`).set(novoValor);
                    console.log("Salvo no Firebase!");
                };
            });
        }

        window.onload = carregarSaaS;
    </script>
</body>
</html>
