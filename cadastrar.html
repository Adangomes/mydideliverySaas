<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Mestre -  SaaS</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #2c3e50; color: white; padding: 20px; }
        .box { background: white; color: #333; padding: 30px; border-radius: 15px; max-width: 500px; margin: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
        label { font-size: 0.8rem; font-weight: bold; color: #666; }
        input { width: 100%; padding: 10px; margin: 5px 0 15px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-save { background: #27ae60; color: white; }
        .btn-search { background: #3498db; color: white; }
        .btn-delete { background: #e74c3c; color: white; margin-top: 10px; width: 100%; }
        button:hover { opacity: 0.8; }
        hr { border: 0; border-top: 1px solid #eee; margin: 20px 0; }
    </style>
</head>
<body>

    <div class="box">
        <h2>Gestão de Restaurantes</h2>
        
        <label>ID da Loja (ex: snoop_lanche)</label>
        <div style="display: flex; gap: 5px;">
            <input type="text" id="id" placeholder="Digite o ID para Criar ou Buscar">
            <button class="btn-search" onclick="buscarLoja()" style="flex: 0; white-space: nowrap; padding: 0 20px; margin-bottom: 15px;">Buscar</button>
        </div>

        <hr>

        <label>Nome do Restaurante:</label>
        <input type="text" id="nome">

        <label>WhatsApp (55...):</label>
        <input type="text" id="zap">

        <label>Endereço Completo (Rua, Nº, Bairro):</label>
        <input type="text" id="rua">

        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>Latitude:</label>
                <input type="text" id="lat">
            </div>
            <div style="flex: 1;">
                <label>Longitude:</label>
                <input type="text" id="lon">
            </div>
        </div>

        <label>Valor por KM (Frete):</label>
        <input type="text" id="km">

        <label>Senha do Dono:</label>
        <input type="text" id="pass">

        <div class="btn-group">
            <button class="btn-save" onclick="salvarLoja()">SALVAR / ATUALIZAR</button>
        </div>
        
        <button class="btn-delete" onclick="excluirLoja()">EXCLUIR RESTAURANTE PERMANENTEMENTE</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCXA1yP1F-riNkzOX5zJs5gsQ82EzsT7Qg",
            authDomain: "myproject26-10f0e.firebaseapp.com",
            databaseURL: "https://myproject26-10f0e-default-rtdb.firebaseio.com",
            projectId: "myproject26-10f0e",
            storageBucket: "myproject26-10f0e.firebasestorage.app",
            messagingSenderId: "884850608032",
            appId: "1:884850608032:web:79db6983346c3c20edc6c5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // BUSCAR LOJA EXISTENTE
        async function buscarLoja() {
            const id = document.getElementById('id').value.toLowerCase().trim();
            if(!id) return alert("Digite o ID da loja para buscar.");

            const snap = await db.ref(`lojas/${id}`).once('value');
            const dados = snap.val();

            if(dados) {
                document.getElementById('nome').value = dados.config.nomeLoja;
                document.getElementById('zap').value = dados.config.whatsapp;
                document.getElementById('rua').value = dados.config.rua;
                document.getElementById('lat').value = dados.config.lat;
                document.getElementById('lon').value = dados.config.lon;
                document.getElementById('km').value = dados.config.valorKm;
                document.getElementById('pass').value = dados.config.senhaAdmin;
                alert("Dados carregados! Agora você pode editar e salvar.");
            } else {
                alert("Loja não encontrada. Você pode preencher os campos para criar uma nova com este ID.");
            }
        }

        // SALVAR OU ATUALIZAR
        async function salvarLoja() {
            const id = document.getElementById('id').value.toLowerCase().trim();
            if(!id) return alert("O ID é obrigatório.");

            // Pegamos o que já existe para não apagar o cardápio (produtos) ao atualizar as configs
            const snap = await db.ref(`lojas/${id}`).once('value');
            const lojaExistente = snap.val();
            const produtosAtuais = lojaExistente ? lojaExistente.produtos : [{title: "Produto Inicial", ingredientes: "Descrição...", price: 0.00, image: "https://via.placeholder.com/150"}];
            const logoAtual = lojaExistente ? lojaExistente.config.logo : "https://via.placeholder.com/150";

            const dados = {
                config: {
                    nomeLoja: document.getElementById('nome').value,
                    whatsapp: document.getElementById('zap').value,
                    rua: document.getElementById('rua').value,
                    lat: document.getElementById('lat').value,
                    lon: document.getElementById('lon').value,
                    valorKm: parseFloat(document.getElementById('km').value) || 0,
                    senhaAdmin: document.getElementById('pass').value,
                    logo: logoAtual
                },
                produtos: produtosAtuais
            };

            await db.ref(`lojas/${id}`).set(dados);
            alert("Sucesso! Loja criada ou atualizada no Firebase.");
        }

        // EXCLUIR DEFINITIVAMENTE
        async function excluirLoja() {
            const id = document.getElementById('id').value.toLowerCase().trim();
            if(!id) return alert("Digite o ID da loja que deseja excluir.");

            const confirmacao = confirm(`TEM CERTEZA? Isso vai apagar o restaurante "${id}" e todos os produtos dele do Firebase para sempre!`);
            
            if(confirmacao) {
                await db.ref(`lojas/${id}`).remove();
                alert("Restaurante removido com sucesso!");
                // Limpa os campos
                document.querySelectorAll('input').forEach(i => i.value = "");
            }
        }
    </script>
</body>
</html>
